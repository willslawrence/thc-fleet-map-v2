<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THC Fleet Map ‚Äî 19 Feb 2026</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; }
  body { margin: 0; font-family: 'Inter', -apple-system, sans-serif; }
  #map { width: 100vw; height: 100vh; transition: height 0.3s ease; }
  body.timeline-open #map { height: 72vh; }
  
  .heli-pin {
    background: rgba(0,0,0,0.85); color: #7eb8ff; padding: 1px 4px;
    border-radius: 3px; font-size: 11px; font-weight: 700;
    white-space: nowrap; border: 1px solid #7eb8ff;
    text-align: center; line-height: 1.2;
  }
  .heli-pin.flying {
    color: #4caf50; border-color: #4caf50;
    animation: pulse 2s ease-in-out infinite;
  }
  .heli-pin.aog { color: #888; border-color: #666; }
  .heli-pin .sub { font-size: 8px; font-weight: 400; opacity: 0.7; display: block; }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(76,175,80,0.5); }
    50% { box-shadow: 0 0 8px 3px rgba(76,175,80,0.3); }
  }
  .base-label {
    background: none; color: rgba(255,255,255,0.4);
    font-size: 13px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase;
  }
  .legend {
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px); color: #ddd; padding: 14px 18px;
    border-radius: 8px; font-size: 12px; line-height: 2.2;
    border: 1px solid rgba(255,255,255,0.12); width: 400px;
  }
  .legend h4 { margin: 0 0 6px; font-size: 14px; color: #fff; }
  .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; vertical-align: middle; }

  .left-panels {
    position: fixed; top: 12px; left: 12px; z-index: 1000;
    width: 400px; max-width: calc(100vw - 24px); max-height: calc(100vh - 24px); overflow-y: auto;
    display: flex; flex-direction: column; gap: 8px;
    scrollbar-width: thin; scrollbar-color: #333 transparent;
  }
  @media (max-width: 480px) {
    .left-panels { width: calc(100vw - 24px); left: 12px; right: 12px; }
    .left-panels > div { padding: 12px 14px; font-size: 11px; }
  }
  body.timeline-open .left-panels { max-height: 70vh; }
  .left-panels > div {
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px); color: #ddd;
    border-radius: 10px; border: 1px solid rgba(255,255,255,0.15);
    padding: 16px 20px; font-size: 12px; line-height: 1.7;
    scrollbar-width: thin; scrollbar-color: #333 transparent;
  }
  #briefing-panel { display: block; }
  #briefing-panel .panel-header { cursor: pointer; user-select: none; }
  #briefing-panel .panel-header:hover { opacity: 0.8; }
  #briefing-panel .panel-title { font-size: 16px; font-weight: 600; color: #fff; margin: 0 0 2px; }
  #briefing-panel .panel-date { font-size: 11px; color: #888; margin: 0 0 12px; }
  #briefing-panel .panel-body { transition: all 0.3s ease; }
  #briefing-panel.collapsed .panel-body { display: none; }
  #currency-panel.collapsed .panel-body { display: none; }

  .legend { cursor: pointer; user-select: none; }
  .legend:hover { opacity: 0.9; }
  .legend.collapsed .legend-body { display: none; }

  #briefing-panel h4 { font-size: 12px; color: #7eb8ff; margin: 12px 0 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 3px; }
  #briefing-panel .flight-row {
    display: flex; gap: 8px; padding: 3px 0;
    border-left: 2px solid #7eb8ff; padding-left: 8px; margin: 3px 0;
  }
  #briefing-panel .flight-row.today { border-left-color: #4caf50; }
  #briefing-panel .flight-row .reg { font-weight: 700; min-width: 50px; font-size: 11px; }
  #briefing-panel .flight-row .info { flex: 1; font-size: 11px; color: #aaa; }
  #briefing-panel .flight-row .pilot { font-size: 11px; color: #888; }
  #briefing-panel .alert, #currency-panel .alert { padding: 3px 8px; border-radius: 4px; font-size: 11px; margin: 3px 0; }
  #briefing-panel .alert.ok, #currency-panel .alert.ok { background: rgba(76,175,80,0.15); border-left: 2px solid #4caf50; }
  #briefing-panel .alert.warn, #currency-panel .alert.warn { background: rgba(255,193,7,0.12); border-left: 2px solid #ffc107; }
  #briefing-panel .alert.danger, #currency-panel .alert.danger { background: rgba(255,82,82,0.12); border-left: 2px solid #ff5252; }
  #briefing-panel .alert.info, #currency-panel .alert.info { background: rgba(52,152,219,0.15); border-left: 2px solid #3498db; }
  #currency-panel h4 { font-size: 12px; color: #7eb8ff; margin: 12px 0 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 3px; }

  #last-updated { display: none; }
  #briefing-panel .panel-header { position: relative; }
  #briefing-panel .panel-updated { position: absolute; top: 0; right: 0; font-size: 10px; color: #666; }
  .duty-roster-btn {
    position: fixed;
    bottom: 10px;
    left: 10px;
    background: rgba(15,15,30,0.85);
    backdrop-filter: blur(12px);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    z-index: 1001;
    text-decoration: none;
    transition: all 0.3s ease;
  }
  .duty-roster-btn:hover { background: rgba(52,152,219,0.3); border-color: rgba(52,152,219,0.5); }
  body.timeline-open .duty-roster-btn { bottom: calc(28vh + 10px); }

  /* Timeline Panel */
  .timeline-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 28vh;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    border-top: 2px solid rgba(46, 204, 113, 0.5);
    transform: translateY(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
    overflow: hidden;
  }
  body.timeline-open .timeline-panel { transform: translateY(0); }

  .timeline-toggle {
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: rgba(15,15,30,0.85);
    backdrop-filter: blur(12px);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    z-index: 1001;
    transition: all 0.3s ease;
  }
  body.timeline-open .timeline-toggle { bottom: calc(28vh + 10px); }
  .timeline-toggle:hover { background: rgba(46, 204, 113, 0.3); border-color: rgba(46, 204, 113, 0.5); }

  /* Timeline Content */
  .timeline-content {
    padding: 8px 20px;
    height: 100%;
    overflow-x: auto;
  }
  .timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }
  .timeline-title {
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    background: linear-gradient(90deg, #2ecc71, #3498db);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .timeline-legend {
    display: flex;
    gap: 12px;
    font-size: 0.55rem;
    color: #888;
  }
  .timeline-legend span { display: flex; align-items: center; gap: 4px; }
  .tl-dot { width: 6px; height: 6px; border-radius: 50%; }
  .tl-dot.current { background: #2ecc71; }
  .tl-dot.future, .tl-dot.confirmed { background: #3498db; }
  .tl-dot.active { background: #2ecc71; }
  .tl-dot.pending { background: #e74c3c; }
  .tl-dot.past, .tl-dot.complete, .tl-dot.canceled, .tl-dot.cancelled { background: #666; opacity: 0.5; }

  
  .timeline-wrapper {
    display: flex;
    height: 100%;
    gap: 15px;
  }
  .tbd-sidebar {
    width: 140px;
    flex-shrink: 0;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 10px;
    overflow-y: auto;
  }
  .tbd-header {
    font-size: 0.65rem;
    font-weight: 600;
    color: #e74c3c;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .tbd-item {
    font-size: 0.55rem;
    color: #aaa;
    padding: 6px 8px;
    margin: 4px 0;
    background: rgba(231, 76, 60, 0.15);
    border-left: 2px solid #e74c3c;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .tbd-item:hover {
    background: rgba(231, 76, 60, 0.25);
    color: #fff;
  }
  .timeline-body {
    flex: 1;
    position: relative;
    min-width: 700px;
  }
  
  .lanes-above { padding-bottom: 6px; }
  .timeline-axis {
    position: relative;
    height: 18px;
    display: flex;
    align-items: center;
  }
  .axis-line {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #2ecc71, #3498db, #2ecc71);
    transform: translateY(-50%);
  }
  .month-tick {
    position: absolute;
    top: 50%;
    transform: translateX(-50%);
    z-index: 10;
  }
  .month-tick::before {
    content: '';
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: 12px;
    background: rgba(255,255,255,0.4);
    top: -6px;
  }
  .tick-label {
  .week-tick {
    position: absolute;
    top: 50%;
    transform: translateX(-50%);
    width: 1px;
    height: 6px;
    background: rgba(255,255,255,0.2);
    margin-top: -3px;
  }
    font-size: 0.45rem;
    font-weight: 600;
    color: #666;
    text-transform: uppercase;
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
  }
  .today-marker {
    position: absolute;
    top: -50px;
    bottom: -50px;
    width: 2px;
    background: #fff;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
    z-index: 100;
  }
  .today-label {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.4rem;
    font-weight: 600;
    color: #fff;
    text-transform: uppercase;
    white-space: nowrap;
    background: rgba(255,255,255,0.15);
    padding: 1px 4px;
    border-radius: 2px;
  }
  .lanes-below { padding-top: 6px; }
  .lane {
    position: relative;
    height: 18px;
    margin-bottom: 2px;
  }
  .event-bar {
    position: absolute;
    height: 16px;
    min-width: 100px;
    border-radius: 3px;
    display: flex;
    align-items: center;
    padding: 0 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: visible;
    font-size: 0.5rem;
  }
  
  
  .event-bar.past, .event-bar.complete, .event-bar.canceled, .event-bar.cancelled {
    background: linear-gradient(135deg, rgba(100, 100, 100, 0.3), rgba(80, 80, 80, 0.2));
    border: 1px dashed rgba(150, 150, 150, 0.4);
    opacity: 0.5;
  }
  .event-bar.past:hover, .event-bar.complete:hover, .event-bar.canceled:hover, .event-bar.cancelled:hover {
    opacity: 0.7;
  }
  .event-bar.past .event-title, .event-bar.complete .event-title, .event-bar.canceled .event-title, .event-bar.cancelled .event-title,
  .event-bar.past .event-dates, .event-bar.complete .event-dates, .event-bar.canceled .event-dates, .event-bar.cancelled .event-dates {
    color: rgba(255, 255, 255, 0.6);
  }
  .event-bar.short {
    min-width: unset;
    padding: 0 4px;
  }
  .event-bar.short .event-title {
    font-size: 0.45rem;
  }
  .event-bar:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(0,0,0,0.4);
  }

/* Vertical separation used instead of minimized overlaps */
  .event-bar.current, .event-bar.active {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.85), rgba(46, 204, 113, 0.65));
    border: 1px solid rgba(46, 204, 113, 0.6);
  }
  .event-bar.future, .event-bar.confirmed {
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.85), rgba(52, 152, 219, 0.65));
    border: 1px solid rgba(52, 152, 219, 0.6);
  }
  .event-bar.pending {
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.85), rgba(231, 76, 60, 0.65));
    border: 1px solid rgba(231, 76, 60, 0.6);
  }
  .event-icon { font-size: 0.65rem; margin-right: 4px; flex-shrink: 0; }
  .event-title { font-size: 0.55rem; font-weight: 600; white-space: nowrap; color: #fff; margin-right: 4px; }
  .event-dates { font-size: 0.45rem; opacity: 0.85; white-space: nowrap; }
  .event-aircraft { display: none; }
  .connector {
    position: absolute;
    width: 1px;
    opacity: 0.4;
  }
  .lanes-above .connector { bottom: -6px; height: 6px; }
  .lanes-below .connector { top: -6px; height: 6px; }
  .event-bar.current .connector, .event-bar.active .connector { background: #2ecc71; }
  .event-bar.future .connector, .event-bar.confirmed .connector { background: #3498db; }
  .event-bar.pending .connector { background: #e74c3c; }

  /* Event popup */
  .event-popup {
    position: fixed;
    background: rgba(15, 15, 30, 0.95);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    padding: 12px 16px;
    min-width: 200px;
    max-width: 280px;
    z-index: 2000;
    color: #fff;
    font-size: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    display: none;
  }
  .event-popup.show { display: block; }
  .event-popup::after {
    content: '';
    position: absolute;
    bottom: -30px;
    left: 20px;
    width: 1px;
    height: 30px;
    background: rgba(255,255,255,0.3);
  }
  .event-popup .popup-scroll {
    max-height: 50vh;
    overflow-y: auto;
  }
  .event-popup h3 {
    margin: 0 0 8px;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .event-popup .status-badge {
    font-size: 9px;
    padding: 2px 6px;
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 600;
  }
  .event-popup .status-badge.current, .event-popup .status-badge.active { background: rgba(46, 204, 113, 0.3); color: #2ecc71; }
  .event-popup .status-badge.future, .event-popup .status-badge.confirmed { background: rgba(52, 152, 219, 0.3); color: #3498db; }
  .event-popup .status-badge.pending { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }
  .event-popup .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .event-popup .detail-row:last-child { border-bottom: none; }
  .event-popup .detail-label { color: #888; }
  .event-popup .detail-value { color: #fff; font-weight: 500; }
</style>
</head>
<body class="timeline-open">
<div id="map"></div>
<div id="last-updated">Last updated: <!-- LAST_UPDATED -->19 Feb 2026 17:00<!-- /LAST_UPDATED --></div>
<a class="duty-roster-btn" href="https://willslawrence.github.io/thc-duty-roster/">üìã Duty Roster</a>

<!-- Timeline Toggle Button -->
<button class="timeline-toggle" onclick="toggleTimeline()">üìÖ Missions</button>

<div class="left-panels">

<div id="briefing-panel" class="collapsed">
  <div class="panel-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <div class="panel-title">üìã Ops Brief ‚ñæ</div>
    <div class="panel-date">OPS PLAN REPORT / <!-- REPORT_PERIOD -->18 Feb ‚Äì 25 Feb 2026<!-- /REPORT_PERIOD --></div>
    <div class="panel-updated">Last Updated: <!-- LAST_UPDATED2 -->19 Feb 2026 17:00<!-- /LAST_UPDATED2 --></div>
  </div>
  <div class="panel-body">

  <!-- FLIGHTS_START -->
  <h4>Thu 19 Feb</h4>
  <div class="flight-row today"><span class="reg">HC66</span><span class="info">XRSC‚ÜíXRFD ¬∑ Training Flight</span><span class="pilot">Schicht, David Peter</span></div>
  <div class="flight-row today"><span class="reg">HC66</span><span class="info">XRFD‚ÜíXRFD ¬∑ Training Flight</span><span class="pilot">Piper, Nathan</span></div>
  <div class="flight-row today"><span class="reg">HC66</span><span class="info">XRFD‚ÜíXRFD ¬∑ Training Flight</span><span class="pilot">le Roux, Lisa kate</span></div>
  <div class="flight-row today"><span class="reg">HC66</span><span class="info">XRFD‚ÜíXRFD ¬∑ Training Flight</span><span class="pilot">Kaundinya, Rohit</span></div>
  <div class="flight-row today"><span class="reg">HC66</span><span class="info">XRFD‚ÜíXRSC ¬∑ Training Flight</span><span class="pilot">Kaundinya, Rohit</span></div>
  <!-- FLIGHTS_END -->

  </div>
</div>

<div id="currency-panel" class="collapsed">
  <div class="panel-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <div class="panel-title">ü©∫ Pilot Currency ‚ñæ</div>
  </div>
  <div class="panel-body">
  <!-- CURRENCY_START -->
  <h4>Competency Checks</h4>
  <div class="alert ok">‚úÖ Nobody due this or next month</div>
  <h4>30-Min REMS (6 month validity)</h4>
  <div class="alert danger">üî¥ David S - expired Jan 2026</div>
  <div class="alert danger">üî¥ Nathan P - expired Jan 2026</div>
  <div class="alert danger">üî¥ Matthias K - expired Jun 2025</div>
  <div class="alert danger">üî¥ Matt O - expired Oct 2025</div>
  <!-- CURRENCY_END -->
  </div>
</div>

</div><!-- /left-panels -->

<!-- Timeline Panel -->
<div class="timeline-panel">
  <div class="timeline-content">
    <div class="timeline-header">
      <div class="timeline-title">THC Missions 2026</div>
      <div class="timeline-legend">
        <span><div class="tl-dot current"></div>Current</span>
        <span><div class="tl-dot future"></div>Future</span>
        <span><div class="tl-dot pending"></div>Pending</span>
        <span><div class="tl-dot past"></div>Past</span>
      </div>
    </div>
    <!-- TIMELINE_START -->
    <div class="timeline-wrapper">
    <div class="timeline-body">
      <div class="lanes-above">
        <div class="lane">
          <div class="event-bar pending short" style="left:25.0%;width:1.2%;" data-name="üèÅ Rally Yanbu 2026" data-status="pending" data-dates="2-5 Apr" data-aircraft="Film: TBA | Ems 1 Sling: TBA | Ems 2: TBA | Vip: TBA" data-pilots="Matt (EMS 1/Sling), Lindsay (EMS 2), Will (VIP), Stephan(Film1), Ivona (Film1)" data-location="Yanbu" data-client="SMC" data-notes="" data-flight-hours="14" onclick="showEventPopup(this,event)" title="üèÅ Rally Yanbu 2026 (2-5 Apr)">
            <span class="event-title">üèÅ Rally Ya...</span>
          </div>
          <div class="event-bar pending short" style="left:29.7%;width:1.2%;" data-name="Bank Riyadh F1 Shuttle" data-status="pending" data-dates="19 Apr" data-aircraft="TBA" data-pilots="TBD" data-location="Jeddah" data-client="Bank Riyadh" data-notes="" data-flight-hours="" onclick="showEventPopup(this,event)" title="Bank Riyadh F1 Shuttle (19 Apr)">
            <span class="event-title">Bank Riyad...</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar complete short" style="left:9.6%;width:1.2%;" data-name="Al Fursan Cup" data-status="complete" data-dates="5-8 Feb" data-aircraft="HC55 (Film)" data-pilots="Lisa" data-location="Riyadh" data-client="Aurora" data-notes="" data-flight-hours="" onclick="showEventPopup(this,event)" title="Al Fursan Cup (5-8 Feb)">
            <span class="event-title">Al Fursan ...</span>
          </div>
          <div class="event-bar pending " style="left:21.7%;width:27.7%;" data-name="üîç Survey GeoTech" data-status="pending" data-dates="21 Mar - 30 Jun" data-aircraft="Survey 1: HC64 | Survey 2: HC63 | Additional: HC58 | Backup: HC54" data-pilots="Survey Pilots" data-location="Al Dawadmi, Abha" data-client="GeoTech" data-notes="Start date March 21" data-flight-hours="450" onclick="showEventPopup(this,event)" title="üîç Survey GeoTech (21 Mar - 30 Jun)">
            <span class="event-title">üîç Survey GeoTech</span>
            <span class="event-dates">21 Mar - 30 Jun</span>
          </div>
          <div class="event-bar pending short" style="left:92.6%;width:1.2%;" data-name="üèÅ Rally Jeddah 2026" data-status="pending" data-dates="4-5 Dec" data-aircraft="Film: TBA | Ems 1 Sling: TBA | Ems 2: TBA | Vip: TBA" data-pilots="TBD" data-location="Jeddah" data-client="SMC" data-notes="" data-flight-hours="14" onclick="showEventPopup(this,event)" title="üèÅ Rally Jeddah 2026 (4-5 Dec)">
            <span class="event-title">üèÅ Rally Je...</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar complete short" style="left:0.0%;width:4.7%;" data-name="üèÅ Rally Dakar 2026" data-status="complete" data-dates="27 Dec - 18 Jan" data-aircraft="TBA" data-pilots="Gilles, Ivona, Lindsay, Matt, Nathan, Stephan, Will" data-location="" data-client="" data-notes="" data-flight-hours="" onclick="showEventPopup(this,event)" title="üèÅ Rally Dakar 2026 (27 Dec - 18 Jan)">
            <span class="event-title">üèÅ Rally Da...</span>
          </div>
          <div class="event-bar complete short" style="left:7.7%;width:1.2%;" data-name="üèÅ Rally Hail 2026" data-status="complete" data-dates="29 Jan - 1 Feb" data-aircraft="TBA" data-pilots="TBD" data-location="" data-client="" data-notes="" data-flight-hours="" onclick="showEventPopup(this,event)" title="üèÅ Rally Hail 2026 (29 Jan - 1 Feb)">
            <span class="event-title">üèÅ Rally Ha...</span>
          </div>
          <div class="event-bar complete short" style="left:12.1%;width:1.2%;" data-name="SELA Company" data-status="complete" data-dates="14-16 Feb" data-aircraft="Main: HC65" data-pilots="Rohit Kaundinya" data-location="Asfan, Jeddah" data-client="SELA" data-notes="Static display + promo video | Stickers install on HC65 | 1 technician on site | Arrive 1100L depart 1745L on 15 Feb | Mohammed (Safety Dept) marshalling on ground" data-flight-hours="12" onclick="showEventPopup(this,event)" title="SELA Company (14-16 Feb)">
            <span class="event-title">SELA Company</span>
          </div>
          <div class="event-bar confirmed " style="left:15.4%;width:84.6%;" data-name="üåÜ Riyadh UAM" data-status="confirmed" data-dates="26 Feb - 31 Dec" data-aircraft="Main: HC66 | Backup: HC67" data-pilots="Rohit, Will, Lisa, David Leipsig, David Schicht, Nathan P, Stephan, Ivona, Lindsay" data-location="Riyadh (OERK)" data-client="THC/RDA" data-notes="Fuel at 350 KG. Pilots Check SFLAs regularly for suitability. Document via the Webapp" data-flight-hours="" onclick="showEventPopup(this,event)" title="üåÜ Riyadh UAM (26 Feb - 31 Dec)">
            <span class="event-title">üåÜ Riyadh UAM</span>
            <span class="event-dates">26 Feb - 31 Dec</span>
          </div>
        </div>
      </div>
      <div class="timeline-axis">
        <div class="axis-line"></div>
        <div class="month-tick" style="left:0.0%;"><span class="tick-label">Jan</span></div>
        <div class="month-tick" style="left:8.5%;"><span class="tick-label">Feb</span></div>
        <div class="month-tick" style="left:16.2%;"><span class="tick-label">Mar</span></div>
        <div class="month-tick" style="left:24.7%;"><span class="tick-label">Apr</span></div>
        <div class="month-tick" style="left:33.0%;"><span class="tick-label">May</span></div>
        <div class="month-tick" style="left:41.5%;"><span class="tick-label">Jun</span></div>
        <div class="month-tick" style="left:49.7%;"><span class="tick-label">Jul</span></div>
        <div class="month-tick" style="left:58.2%;"><span class="tick-label">Aug</span></div>
        <div class="month-tick" style="left:66.8%;"><span class="tick-label">Sep</span></div>
        <div class="month-tick" style="left:75.0%;"><span class="tick-label">Oct</span></div>
        <div class="month-tick" style="left:83.5%;"><span class="tick-label">Nov</span></div>
        <div class="month-tick" style="left:91.8%;"><span class="tick-label">Dec</span></div>
        <div class="week-tick" style="left:1.1%;"></div>
        <div class="week-tick" style="left:3.0%;"></div>
        <div class="week-tick" style="left:4.9%;"></div>
        <div class="week-tick" style="left:6.9%;"></div>
        <div class="week-tick" style="left:8.8%;"></div>
        <div class="week-tick" style="left:10.7%;"></div>
        <div class="week-tick" style="left:12.6%;"></div>
        <div class="week-tick" style="left:14.6%;"></div>
        <div class="week-tick" style="left:16.5%;"></div>
        <div class="week-tick" style="left:18.4%;"></div>
        <div class="week-tick" style="left:20.3%;"></div>
        <div class="week-tick" style="left:22.3%;"></div>
        <div class="week-tick" style="left:24.2%;"></div>
        <div class="week-tick" style="left:26.1%;"></div>
        <div class="week-tick" style="left:28.0%;"></div>
        <div class="week-tick" style="left:29.9%;"></div>
        <div class="week-tick" style="left:31.9%;"></div>
        <div class="week-tick" style="left:33.8%;"></div>
        <div class="week-tick" style="left:35.7%;"></div>
        <div class="week-tick" style="left:37.6%;"></div>
        <div class="week-tick" style="left:39.6%;"></div>
        <div class="week-tick" style="left:43.4%;"></div>
        <div class="week-tick" style="left:45.3%;"></div>
        <div class="week-tick" style="left:47.3%;"></div>
        <div class="week-tick" style="left:49.2%;"></div>
        <div class="week-tick" style="left:51.1%;"></div>
        <div class="week-tick" style="left:53.0%;"></div>
        <div class="week-tick" style="left:54.9%;"></div>
        <div class="week-tick" style="left:56.9%;"></div>
        <div class="week-tick" style="left:58.8%;"></div>
        <div class="week-tick" style="left:60.7%;"></div>
        <div class="week-tick" style="left:62.6%;"></div>
        <div class="week-tick" style="left:64.6%;"></div>
        <div class="week-tick" style="left:66.5%;"></div>
        <div class="week-tick" style="left:68.4%;"></div>
        <div class="week-tick" style="left:70.3%;"></div>
        <div class="week-tick" style="left:72.3%;"></div>
        <div class="week-tick" style="left:74.2%;"></div>
        <div class="week-tick" style="left:76.1%;"></div>
        <div class="week-tick" style="left:78.0%;"></div>
        <div class="week-tick" style="left:79.9%;"></div>
        <div class="week-tick" style="left:81.9%;"></div>
        <div class="week-tick" style="left:83.8%;"></div>
        <div class="week-tick" style="left:85.7%;"></div>
        <div class="week-tick" style="left:87.6%;"></div>
        <div class="week-tick" style="left:89.6%;"></div>
        <div class="week-tick" style="left:91.5%;"></div>
        <div class="week-tick" style="left:93.4%;"></div>
        <div class="week-tick" style="left:95.3%;"></div>
        <div class="week-tick" style="left:97.3%;"></div>
        <div class="week-tick" style="left:99.2%;"></div>
        <div class="today-marker" style="left:13.5%;"></div>
      </div>
      <div class="lanes-below">
        <div class="lane">
          <div class="event-bar complete short" style="left:6.6%;width:1.9%;" data-name="üèúÔ∏è AlUla Tour 2026" data-status="complete" data-dates="25 Jan - 1 Feb" data-aircraft="TBA" data-pilots="Julio" data-location="" data-client="" data-notes="" data-flight-hours="" onclick="showEventPopup(this,event)" title="üèúÔ∏è AlUla Tour 2026 (25 Jan - 1 Feb)">
            <span class="event-title">üèúÔ∏è AlUla T...</span>
          </div>
          <div class="event-bar complete short" style="left:13.5%;width:1.2%;" data-name="üåÜ UAM KAFD Training" data-status="complete" data-dates="19 Feb" data-aircraft="Main: HC66" data-pilots="Will Lawrence, Rohit Kaundinya, Lisa le Roux, David Schicht, Nathan Piper" data-location="KAFD 106 Helipad / XRSC" data-client="THC" data-notes="Thursday 11am" data-flight-hours="" onclick="showEventPopup(this,event)" title="üåÜ UAM KAFD Training (19 Feb)">
            <span class="event-title">üåÜ UAM KAFD...</span>
          </div>
          <div class="event-bar pending " style="left:15.9%;width:12.6%;" data-name="üîç Survey Argas" data-status="pending" data-dates="28 Feb - 15 Apr" data-aircraft="Survey: HC59 | Backup Initial: HC63 | Backup March: HC54" data-pilots="Survey Pilots" data-location="Yanbu ‚Üí Rabigh ‚Üí North Abha" data-client="Argas" data-notes="" data-flight-hours="> 100" onclick="showEventPopup(this,event)" title="üîç Survey Argas (28 Feb - 15 Apr)">
            <span class="event-title">üîç Survey Argas</span>
            <span class="event-dates">28 Feb - 15 Apr</span>
          </div>
          <div class="event-bar pending short" style="left:34.9%;width:1.2%;" data-name="üèÅ Rally Qassim 2026" data-status="pending" data-dates="8-9 May" data-aircraft="Film: TBA | Ems 1 Sling: TBA | Ems 2: TBA | Vip: TBA" data-pilots="TBD" data-location="Qassim" data-client="SMC" data-notes="" data-flight-hours="14" onclick="showEventPopup(this,event)" title="üèÅ Rally Qassim 2026 (8-9 May)">
            <span class="event-title">üèÅ Rally Qa...</span>
          </div>
          <div class="event-bar pending short" style="left:91.8%;width:1.2%;" data-name="üèÅ Rally WRC 2026" data-status="pending" data-dates="1-2 Dec" data-aircraft="Film: TBA | Ems 1 Sling: TBA | Ems 2: TBA | Vip: TBA" data-pilots="Will (VIP)" data-location="TBD" data-client="SMC" data-notes="Dates pending | H145 included | Front passenger seat for EMS 1" data-flight-hours="25" onclick="showEventPopup(this,event)" title="üèÅ Rally WRC 2026 (1-2 Dec)">
            <span class="event-title">üèÅ Rally WR...</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar complete short" style="left:10.4%;width:1.2%;" data-name="üé¨ Promo Filming" data-status="complete" data-dates="8-9 Feb" data-aircraft="HC68 (Film)" data-pilots="David Liepsig (Pax)" data-location="Riyadh" data-client="THC" data-notes="6:20 - 6:40 takeoff before sunrise. Two shots ‚Äî (1) blades turning, actor arrives/boards, takeoff ~10m; (2) filming in flight ~40min. Cameraman inside + outside." data-flight-hours="<1" onclick="showEventPopup(this,event)" title="üé¨ Promo Filming (8-9 Feb)">
            <span class="event-title">üé¨ Promo Fi...</span>
          </div>
          <div class="event-bar pending " style="left:23.1%;width:76.9%;" data-name="üåâ Bahrain Skybridge" data-status="pending" data-dates="26 Mar - 31 Dec" data-aircraft="Main: HC68 | Backup: HC67" data-pilots="UAM Pilots, Nathan P" data-location="DMM‚ÜíBAH" data-client="THC" data-notes="Pilot apartment | DMM‚ÜíBAH via VRP East Gate‚ÜíLADNA | BAH‚ÜíDMM via NARMI (min 6000ft) | Direct route pending SANS/BAH CAA/THC meeting | Need annual landing permit BAH | Floats + 6 life jackets req | Ground handling SPA (DMM) JETEX (BAH) | ~500kg payload one-way fuel" data-flight-hours="" onclick="showEventPopup(this,event)" title="üåâ Bahrain Skybridge (26 Mar - 31 Dec)">
            <span class="event-title">üåâ Bahrain Skybridge</span>
            <span class="event-dates">26 Mar - 31 Dec</span>
          </div>
        </div>
      </div>
    </div>
    </div>
    <!-- TIMELINE_END -->

  </div>
</div>

<!-- Event Popup (outside timeline for z-index) -->
<div class="event-popup" id="eventPopup"></div>

<script>
function toggleTimeline() {
  document.body.classList.toggle('timeline-open');
  setTimeout(() => map.invalidateSize(), 350);
}

const bases = {
  // Main bases
  OETH:  { lat: 25.213, lng: 46.640, name: "THUMAMAH" },
  RUH:   { lat: 24.680, lng: 46.820, name: "ALSALAM / RIYADH" },
  XRSC:  { lat: 24.680, lng: 46.820, name: "ALSALAM / RIYADH" },
  OERK:  { lat: 24.680, lng: 46.820, name: "ALSALAM / RIYADH" },
  ALSALAM: { lat: 24.680, lng: 46.820, name: "ALSALAM / RIYADH" },
  // Regional airports
  OEHL:  { lat: 27.438, lng: 41.686, name: "HA'IL" },
  OEGS:  { lat: 26.303, lng: 43.774, name: "GASSIM" },
  OEAO:  { lat: 26.485, lng: 38.126, name: "AL ULA" },
  OEGN:  { lat: 16.901, lng: 42.586, name: "JIZAN" },
  OEJN:  { lat: 21.680, lng: 39.157, name: "JEDDAH" },
  OEJF:  { lat: 21.348, lng: 39.173, name: "JEDDAH NAVAL" },
  OEMA:  { lat: 24.553, lng: 39.705, name: "MADINAH" },
  // Red Sea
  OERS:  { lat: 22.072, lng: 39.110, name: "RED SEA INTL" },
  XSCV:  { lat: 22.450, lng: 39.100, name: "RED SEA CAMP" },
  XSSB:  { lat: 22.380, lng: 39.050, name: "SHURA BAY" },
  XSTH:  { lat: 22.320, lng: 39.020, name: "TURTLE HUB" },
  XSDR:  { lat: 22.250, lng: 38.980, name: "DISCOVERY" },
  XSUH:  { lat: 22.400, lng: 39.080, name: "UMMAHAT" },
  XSU3:  { lat: 22.350, lng: 39.040, name: "U3 HELIPAD" },
  // NEOM
  OENN:  { lat: 28.024, lng: 35.147, name: "NEOM BAY" },
  XNC1:  { lat: 28.100, lng: 35.200, name: "NEOM CAMP 1" },
  XNCH:  { lat: 28.050, lng: 35.180, name: "NEOM HELIPAD" },
  XNNH:  { lat: 28.080, lng: 35.160, name: "NEOM NORTH" },
  XNPI:  { lat: 28.000, lng: 35.100, name: "NEOM PIER" },
  // Al Ula / XURC area
  XUFR:  { lat: 26.600, lng: 37.900, name: "AL ULA FBO" },
  XURC:  { lat: 26.550, lng: 37.850, name: "AL ULA RC" },
};

// FLEET_START
const fleet = [
  { reg: "HZHC52", loc: "RUH", status: "parked", fullStatus: "Serviceable", note: "Aircraft Under Process for Sale, Export C of A issued by GACA.", mission: "Short Term Storage", remFH: "117:05" },
  { reg: "HZHC54", loc: "OETH", status: "parked", fullStatus: "Serviceable", mission: "Available", remFH: "76:46" },
  { reg: "HZHC55", loc: "OETH", status: "parked", fullStatus: "Serviceable", mission: "None", remFH: "38:40" },
  { reg: "HZHC57", loc: "OERK", status: "parked", fullStatus: "Serviceable", note: "Export C of A inspection by GACA completed on 18 Feb 2026", remFH: "79:48" },
  { reg: "HZHC58", loc: "OERK", status: "maint", fullStatus: "Maintenance", note: "Aircraft under maintenance for 24M/750FH and 72 Months", ert: "2026-03-12", remFH: "66:47" },
  { reg: "HZHC59", loc: "OETH", status: "parked", fullStatus: "Serviceable", remFH: "90:41" },
  { reg: "HZHC62", loc: "OETH", status: "parked", fullStatus: "Serviceable", remFH: "41:24" },
  { reg: "HZHC63", loc: "OETH", status: "parked", fullStatus: "Serviceable", mission: "Available", remFH: "102:10" },
  { reg: "HZHC64", loc: "OETH", status: "parked", fullStatus: "Serviceable", note: "Aircraft under MEL, Waiting for Air Conditioning charging", remFH: "96:08" },
  { reg: "HZHC65", loc: "OETH", status: "parked", fullStatus: "Serviceable", mission: "SELA", remFH: "129:51" },
  { reg: "HZHC66", loc: "OERK", status: "flying", fullStatus: "Serviceable", note: "Primary Aircraft for UAM Project", mission: "[[Urban Air Mobility|Riyadh UAM]]", remFH: "128:51", pilot: "Kaundinya, Rohit", route: "XRFD‚ÜíXRSC" },
  { reg: "HZHC67", loc: "OETH", status: "parked", fullStatus: "Serviceable", mission: "UAM backup", remFH: "142:42" },
  { reg: "HZHC68", loc: "OETH", status: "parked", fullStatus: "Serviceable", remFH: "140:32" },
  { reg: "HZHC69", loc: "OETH", status: "parked", fullStatus: "Serviceable", note: "Aircraft under MEL, GTN received on 07 Feb 2026 and waiting for the installation", remFH: "141:31" },
];
// FLEET_END

const map = L.map('map', { zoomControl: false }).setView([26.2, 42.5], 6);
L.control.zoom({ position: 'topright' }).addTo(map);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '¬© OSM ¬© CARTO', maxZoom: 18
}).addTo(map);

Object.values(bases).forEach(b => {
  L.marker([b.lat, b.lng], {
    icon: L.divIcon({ className: 'base-label', html: b.name, iconAnchor: [40, -20] }),
    interactive: false
  }).addTo(map);
  L.circle([b.lat, b.lng], { radius: 18000, color: 'rgba(255,255,255,0.08)', fillColor: 'rgba(255,255,255,0.03)', weight: 1 }).addTo(map);
});

const groups = {};
fleet.forEach(h => {
  if (!groups[h.loc]) groups[h.loc] = [];
  groups[h.loc].push(h);
});

// Layer group for helicopters (so we can redraw on zoom)
const heliLayer = L.layerGroup().addTo(map);

// Calculate radius based on zoom (larger when zoomed out)
function getRadius(zoom) {
  // Zoom 6 = very far out (whole country), zoom 12 = close
  // Increased separation for better readability
  const baseRadius = 1.5;
  const scale = Math.pow(2, 10 - zoom);
  return Math.max(0.08, Math.min(2.0, baseRadius * scale / 16));
}

function drawHelicopters() {
  heliLayer.clearLayers();
  const zoom = map.getZoom();
  const radius = getRadius(zoom);
  
  fleet.forEach(h => {
    const b = bases[h.loc];
    if (!b) return;
    const g = groups[h.loc];
    const i = g.indexOf(h);
    const n = g.length;
    
    // Radial layout: arrange helicopters in a semicircle
    // OETH ‚Üí north half only, RUH/Alsalam/OERK ‚Üí south 90¬∞ arc
    // Angle 0¬∞ = North, 90¬∞ = East, 180¬∞ = South, -90¬∞ = West
    const northBases = ['OETH'];
    const southBases = ['RUH', 'XRSC', 'OERK'];
    
    let startAngle, spread;
    if (northBases.includes(h.loc)) {
      startAngle = -90; spread = 180; // West through North to East
    } else if (southBases.includes(h.loc)) {
      startAngle = 135; spread = 90; // SE through South to SW (90¬∞ arc)
    } else {
      startAngle = 0; spread = 360; // Full circle for other bases
    }
    
    const angle = (startAngle + (i * spread / Math.max(n - 1, 1))) * Math.PI / 180;
    // Vary distance: alternating helicopters closer/further (0.7x and 1.0x)
    const distMult = (i % 2 === 0) ? 1.0 : 0.7;
    const latOff = n > 1 ? radius * distMult * Math.cos(angle) : 0;
    const lngOff = n > 1 ? radius * distMult * 1.3 * Math.sin(angle) : 0;
    const lat = b.lat + latOff;
    const lng = b.lng + lngOff;
    
    // Draw radial line from base to helicopter
    if (n > 1) {
      L.polyline([[b.lat, b.lng], [lat, lng]], {
        color: 'rgba(255,255,255,0.3)', weight: 1
      }).addTo(heliLayer);
    }

    const cls = h.status === 'flying' ? 'flying' : h.status === 'aog' ? 'aog' : h.status === 'maint' ? 'aog' : '';
    let label = h.reg.replace('HZHC','HC');
    if (h.pilot) label += `<span class="sub">${h.pilot}</span>`;
    if (h.status === 'aog') label += `<span class="sub">AOG</span>`;
    if (h.status === 'maint' && h.ert) label += `<span class="sub">ERT ${h.ert}</span>`;
    else if (h.status === 'maint') label += `<span class="sub">MAINT</span>`;

    const color = h.status === 'flying' ? '#4caf50' : h.status === 'aog' ? '#666' : h.status === 'maint' ? '#ff9800' : '#7eb8ff';
    L.circleMarker([lat, lng], {
      radius: 3, fillColor: color, color: '#fff', weight: 1, fillOpacity: 0.85
    }).addTo(heliLayer);

    L.marker([lat, lng], {
      icon: L.divIcon({
        className: `heli-pin ${cls}`,
        html: label,
        iconSize: [46, 18],
        iconAnchor: [-6, 12]
      })
    }).addTo(heliLayer).bindPopup(
      `<b>${h.reg}</b><br>Base: ${h.loc}` +
      `<br>Status: ${h.status === 'flying' ? 'üü¢ Flying' : h.status === 'maint' ? 'üü† Maintenance' : h.status === 'aog' ? 'üî¥ AOG' : 'üîµ Serviceable'}` +
      (h.ert ? `<br>üîß ERT: ${h.ert}` : '') +
      (h.note ? `<br><em>${h.note}</em>` : '') +
      (h.mission ? `<br>Mission: ${h.mission}` : '') +
      (h.pilot ? `<br>PIC: ${h.pilot}` : '') + (h.route ? `<br>Route: ${h.route}` : '')
    );
  });
}

// Draw initially and on zoom changes
drawHelicopters();
map.on('zoomend', drawHelicopters);

// Draw flight path lines for helicopters with routes
fleet.filter(h => h.route && h.status === 'flying').forEach(h => {
  const parts = h.route.split('‚Üí').map(p => p.trim());
  const coords = parts.map(p => bases[p]).filter(b => b);
  if (coords.length >= 2) {
    const latlngs = coords.map(c => [c.lat, c.lng]);
    L.polyline(latlngs, {
      color: '#4caf50', weight: 2.5, opacity: 0.6, dashArray: '10 8'
    }).addTo(map).bindPopup(`<b>${h.reg}</b><br>${h.route}<br>PIC: ${h.pilot || 'TBD'}`);
    // Add waypoint markers
    coords.forEach((c, i) => {
      if (i > 0 && i < coords.length - 1) {
        L.circleMarker([c.lat, c.lng], {
          radius: 4, fillColor: '#4caf50', color: '#fff', weight: 1, fillOpacity: 0.8
        }).addTo(map);
      }
    });
  }
});

const pts = fleet.filter(h => bases[h.loc]).map(h => [bases[h.loc].lat, bases[h.loc].lng]);
map.fitBounds(L.latLngBounds(pts).pad(0.15));

// Legend removed per Will's request (2026-02-08)

// Event popup handling
function dismissEventPopup() {
  document.getElementById('eventPopup').style.display = 'none';
  document.getElementById('eventPopup').classList.remove('show');
}

function showEventPopup(el, e) {
  const popup = document.getElementById('eventPopup');
  const data = el.dataset;
  const statusLabel = {'active':'Active','current':'Active','confirmed':'Confirmed','future':'Confirmed','pending':'Pending','past':'Past','complete':'Complete'}[data.status] || data.status;
  
  // Format aircraft roles as individual lines
  let aircraftHtml = data.aircraft;
  if (data.aircraft && data.aircraft.includes('|')) {
    aircraftHtml = data.aircraft.split(' | ').map(r => {
      const [role, reg] = r.split(': ');
      const isTBD = !reg || reg === 'TBD';
      return `<div style="padding:1px 0;"><span style="color:#888;">${role}:</span> <span style="color:${isTBD ? '#666' : '#7eb8ff'}">${reg || 'TBD'}</span></div>`;
    }).join('');
  }
  
  var html = '<div class="popup-scroll"><h3 style="padding-right:20px">' + data.name + ' <span class="status-badge ' + data.status + '">' + statusLabel + '</span></h3>';
  html += '<div class="detail-row"><span class="detail-label">Dates</span><span class="detail-value">' + data.dates + '</span></div>';
  if (data.location) html += '<div class="detail-row"><span class="detail-label">Location</span><span class="detail-value">' + data.location + '</span></div>';
  if (data.client) html += '<div class="detail-row"><span class="detail-label">Client</span><span class="detail-value">' + data.client + '</span></div>';
  html += '<div class="detail-row"><span class="detail-label">Aircraft</span><span class="detail-value">' + aircraftHtml + '</span></div>';
  html += '<div class="detail-row"><span class="detail-label">Pilots</span><span class="detail-value">' + data.pilots + '</span></div>';
  if (data.flightHours) html += '<div class="detail-row"><span class="detail-label">Flight Hours</span><span class="detail-value">' + data.flightHours + ' hrs (est)</span></div>';
  if (data.notes) html += '<div class="detail-row"><span class="detail-label">Notes</span><span class="detail-value" style="font-size:0.7rem;color:#aaa">' + data.notes + '</span></div>';
  html += '</div>'; // close popup-scroll
  html = '<div style="text-align:right;margin:-4px -8px 4px 0"><a href="javascript:void(0)" id="eventPopupClose" style="color:#888;font-size:20px;text-decoration:none;padding:4px 8px">&times;</a></div>' + html;
  popup.innerHTML = html;
  document.getElementById('eventPopupClose').onclick = function() { dismissEventPopup(); return false; };
  
  const rect = el.getBoundingClientRect();
  // Position popup, then measure and adjust to stay on screen
  popup.style.visibility = 'hidden';
  popup.style.display = 'block';
  popup.style.left = Math.min(rect.left, window.innerWidth - 290) + 'px';
  popup.style.top = '0px'; // temporary
  const popupH = popup.offsetHeight;
  // Place above the bar with a 30px connector gap
  let top = rect.top - popupH - 30;
  if (top < 8) top = 8; // don't go off top of screen
  popup.style.top = top + 'px';
  popup.style.visibility = '';
  popup.classList.add('show');
}
</script>
</body>
</html>
